<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script src="lib/matter.min.js"></script>

    <script>
        const Example = {};

        Example.sprites = function () {

            function boll(name, x, y) {
                return Bodies.circle(x, y, 98 / 2, {
                    density: 0.0005,
                    frictionAir: 0.06,
                    restitution: 0.3,
                    friction: 0.01,
                    render: {
                        sprite: {
                            texture: `./dearfriends/${name}.png`
                        }
                    }
                });
            }

            // De yttre måtten

            const width = 800
            const height = 1200

            // Kortare alias
            
            const Engine = Matter.Engine,
                  Render = Matter.Render,
                  Runner = Matter.Runner,
                  Composites = Matter.Composites,
                  Common = Matter.Common,
                  MouseConstraint = Matter.MouseConstraint,
                  Mouse = Matter.Mouse,
                  Composite = Matter.Composite,
                  Bodies = Matter.Bodies;

            // Setup av engine, värld, rendering, runner

            const engine = Engine.create();
            const world = engine.world;

            const render = Render.create({
                element: document.body,
                engine: engine,
                options: {
                    width: width,
                    height: height,
                    showAngleIndicator: false,
                    wireframes: false
                }
            });

            Render.run(render);

            const runner = Runner.create();
            Runner.run(runner, engine);

            // Lägg till fyra fasta vägger till världen

            const wallThickness = 30
            const options = { isStatic: true };

            world.bodies = [];

            Composite.add(world, [

                // centerX, centerY, width, height
                Bodies.rectangle(width / 2, 0, width, wallThickness, options),
                Bodies.rectangle(width / 2, height, width, wallThickness, options),

                Bodies.rectangle(0, height / 2, wallThickness, height, options),
                Bodies.rectangle(width, height / 2, wallThickness, height, options),
            ]);

            // Lägg till bollar till världen

            // x, y, kolumner, rader, gap, gap, callback
            const stack = Composites.stack(0, 0, 5, 4, 0, 0, function (x, y) {
                if (Common.random() > 0.35) {
                    return boll('nils', x, y)
                } else {
                    return boll('oscar', x, y)
                }
            });

            Composite.add(world, stack);

            // Lägg till mus till världen för att kunna flytta på bollar
            const mouse = Mouse.create(render.canvas)
            const mouseConstraint = MouseConstraint.create(engine, {
                mouse: mouse,
                constraint: {
                    stiffness: 0.2,
                    render: {
                        visible: true
                    }
                }
            });

            Composite.add(world, mouseConstraint);

            // Låt musen synkas med renderingen
            render.mouse = mouse;

            // Låt "viewport" vara något större än scenen

            const lookOffset = 100

            Render.lookAt(render, {
                min: { x: 0 - lookOffset, y: 0 - lookOffset },
                max: { x: width + lookOffset, y: height + lookOffset }
            });

        };

        Example.sprites()

    </script>




</body>

</html>