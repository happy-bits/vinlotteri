<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script src="lib/matter.min.js"></script>

    <script>
        const Example = {};

        Example.sprites = function () {

            function createBoll(name) {
                const t = wall.thickness/2
                const x = Common.random(boll.radius + t, wall.diameter - boll.radius - t)
                const y = Common.random(boll.radius + t, wall.diameter - boll.radius - t)
                return Bodies.circle(x, y, 98 / 2, {
                    density: 0.0005,
                    frictionAir: 0.06,
                    restitution: 0.3,
                    friction: 0.01,
                    render: {
                        sprite: {
                            texture: `./dearfriends/${name}.png`
                        }
                    }
                });
            }

            function createWallOfCircles() {
                
                const vDiff = Math.PI/60;
                const options = { isStatic: true };
                const circles = []
                for(let v=0; v<Math.PI*2; v+=vDiff) {

                    circles.push(Bodies.circle(Math.cos(v)*wall.radius+wall.radius, Math.sin(v)*wall.radius+wall.radius, wall.thickness/2, options))
                }
                return circles                

            }
            // De yttre måtten

            const boll = { diameter: 98, radius: 49 }
            const wall = { thickness: 20, diameter:800, radius:400 }

            // Kortare alias

            const Engine = Matter.Engine,
                Render = Matter.Render,
                Runner = Matter.Runner,
                Composites = Matter.Composites,
                Common = Matter.Common,
                MouseConstraint = Matter.MouseConstraint,
                Mouse = Matter.Mouse,
                Composite = Matter.Composite,
                Bodies = Matter.Bodies;

            // Setup av engine, värld, rendering, runner

            const engine = Engine.create();
            const world = engine.world;

            const render = Render.create({
                element: document.body,
                engine: engine,
                options: {
                    width: wall.diameter,
                    height: wall.diameter+500,
                    showAngleIndicator: false,
                    wireframes: false
                }
            });

            Render.run(render);

            const runner = Runner.create();
            
            // Static = påverkas inte av tyngdkraften (kan ej ändra position eller angle)
            // Properties för ett objekt https://brm.io/matter-js/docs/classes/Body.html#properties

            
            
            world.bodies = [];
            
            Composite.add(world, createWallOfCircles());
            
            // Lägg till bollar till världen
            
            for (let i = 0; i < 20; i++) {
                
                const x1 = createBoll('oscar')
                const x2 = createBoll('nils')
                Composite.add(world, [x1, x2]);
            }
            
            // Låt "viewport" vara något större än scenen
            
            const lookOffset = 100
            
            Render.lookAt(render, {
                min: { x: 0 - lookOffset, y: 0 - lookOffset },
                max: { x: wall.diameter + lookOffset, y: wall.diameter + lookOffset }
            });
            
            document.body.onclick = () => {
                
                Runner.run(runner, engine);

            }

        };
        
        Example.sprites()

    </script>




</body>

</html>