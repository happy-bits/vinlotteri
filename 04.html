<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script src="lib/matter.min.js"></script>

    <script>
        const Example = {};

        Example.sprites = function () {

            function createBoll(name) {
                const t = wall.diameter / 2

                const r = Math.random() * wall.radius - boll.radius;
                const angle = Math.random() * Math.PI * 2;

                const x = r * Math.cos(angle) + wall.radius
                const y = r * Math.sin(angle) + wall.radius

                return Bodies.circle(x, y, 98 / 2, {
                    density: 0.0005,
                    frictionAir: 0.06,
                    restitution: 0.3,
                    friction: 0.01,
                    render: {
                        sprite: {
                            texture: `./dearfriends/${name}.png`
                        }
                    }
                });
            }

            function createWallOfCircles() {

                const vDiff = Math.PI / 60;
                const options = { isStatic: true };
                const circles = []

                for (let v = 0; v < Math.PI * 2; v += vDiff) {

                    // const threeQuater = 3/4*2*Math.PI
                    // if (v>=threeQuater-1 &&v <threeQuater+1 ){
                    //     continue
                    // }

                    let x = Math.cos(v) * wall.radius + wall.radius
                    let y = Math.sin(v) * wall.radius + wall.radius
                    circles.push(Bodies.circle(x, y, wall.thickness, options))
                }
                return circles

            }


            const boll = { diameter: 98, radius: 49 }
            const wall = { thickness: 20, diameter: 800, radius: 400 }
            const mixer = { diameter: 172, radius: 172 / 2, angle:0 }
            let time = 0

            // Kortare alias

            const Engine = Matter.Engine,
                Render = Matter.Render,
                Runner = Matter.Runner,
                Composites = Matter.Composites,
                Common = Matter.Common,
                MouseConstraint = Matter.MouseConstraint,
                Mouse = Matter.Mouse,
                Composite = Matter.Composite,
                Bodies = Matter.Bodies,
                Vector = Matter.Vector;

            // Setup av engine, värld, rendering, runner

            const engine = Engine.create();
            const world = engine.world;

            const render = Render.create({
                element: document.body,
                engine: engine,
                options: {
                    width: wall.diameter,
                    height: wall.diameter + 500,
                    showAngleIndicator: false,
                    wireframes: false
                }
            });

            Render.run(render);

            const runner = Runner.create();

            // Static = påverkas inte av tyngdkraften (kan ej ändra position eller angle)
            // Properties för ett objekt https://brm.io/matter-js/docs/classes/Body.html#properties

            world.bodies = [];

            Composite.add(world, createWallOfCircles());

            // Lägg till bollar till världen

            for (let i = 0; i < 7; i++) {

                const x1 = createBoll('oscar')
                const x2 = createBoll('nils')
                const x3 = createBoll('macke')
                const x4 = createBoll('madde')
                /////////// Composite.add(world, [x1, x2, x3, x4]);
            }

            const mixerBall = Bodies.circle(wall.diameter - 150, wall.radius, mixer.radius, {
                density: 0.005,  // hög densitet => pressas
                frictionAir: 0.06,
                restitution: 0.3, // 0 => 1. Elastisitet. 0 = ingen studs
                friction: 0.01,   // 0 => 1. O = kan glida länge. 1 = stannar direkt
                render: {
                    sprite: {
                        texture: `./dearfriends/drunk-172-200.png`
                    }
                }
            });

            Composite.add(world, mixerBall)
            // Låt "viewport" vara något större än scenen

            const lookOffset = 100

            Render.lookAt(render, {
                min: { x: 0 - lookOffset, y: 0 - lookOffset },
                max: { x: wall.diameter + lookOffset, y: wall.diameter + lookOffset }
            });


            function moveMixer(endX, endY, force) {

                console.log(endX, endY)

                const position = {
                    x: mixerBall.position.x,
                    y: mixerBall.position.y
                }

                
                let forceVector = Vector.create(endX - position.x, endY - position.y)

                forceVector = Vector.normalise(forceVector)

                forceVector = Vector.mult(forceVector, force)

                Matter.Body.applyForce(mixerBall, position, forceVector)

            }

            function moveAgainstWall() {
                moveMixer(
                    wall.radius * Math.cos(mixer.angle) + wall.radius,
                    wall.radius * Math.sin(mixer.angle) + wall.radius,
                    1
                )
            }


            // function moveMixerSouth() {

            //     moveMixer(wall.radius, wall.diameter, 3)

            // }

            // function moveMixerWest() {

            //     moveMixer(0, wall.radius, 3)

            // }

            // function moveMixerNorth() {

            //     moveMixer(wall.radius, 0, 6)

            // }

            // function moveMixerEast() {

            //     moveMixer(wall.diameter, wall.radius, 3)

            // }

            document.body.onclick = () => {

                // Matter.Body.setStatic(mixer, true)

                console.log("time", time)

                Runner.run(runner, engine);

                setInterval(() => {
                    time +=100
                    mixer.angle += 0.9
                }, 300)

                setInterval(() => {

                    moveAgainstWall()
                }, 100)

                // setTimeout(() => {
                //     moveMixerSouth()
                // }, 300)

                // setTimeout(() => {
                //     moveMixerWest()
                // }, 900)

                // setTimeout(() => {
                //     moveMixerNorth()
                // }, 1600)

                // setTimeout(() => {
                //     moveMixerEast()
                // }, 2600)

                // 3300
            }

        };

        Example.sprites()

    </script>




</body>

</html>